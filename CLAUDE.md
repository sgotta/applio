# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Applio** is a CV builder with a minimalist Notion-style inline editing experience. Built with Next.js 16 App Router, React 19, and Tailwind CSS v4. Currently client-side with localStorage persistence, exploring auth and server-side persistence.

## Version Bumping

When creating a commit, **always** bump the `version` field in `package.json` before committing:
- **patch** (1.9.0 → 1.9.1): bug fixes, small tweaks, copy changes
- **minor** (1.9.0 → 1.10.0): new features, new sections, significant UI changes
- **major** (1.9.0 → 2.0.0): breaking changes, major rewrites (rare — only when explicitly requested)

Ask the user to confirm the version bump level before applying it. A GitHub Action automatically creates a release when the version changes on `main`.

## Commands

```bash
# Development
npm run dev          # Start dev server at http://localhost:3000
npm run build        # Build for production (TypeScript type-checks included)
npm run lint         # Run ESLint

# Add shadcn/ui components
npx shadcn@latest add [component-name]

# Deploy
vercel               # Deploy to production (requires Vercel CLI)
```

## Architecture

### State Management: CVContext Pattern

All application state lives in `src/lib/cv-context.tsx` using React Context API. This is the **single source of truth** for CV data.

**Key characteristics:**
- ~15 CRUD methods (add, update, remove, move operations)
- All methods use `useCallback` for memoization
- Immutable updates with spread operator and functional setState
- Auto-save to localStorage with 500ms debounce
- Migration function (`migrateCVData`) for backward compatibility with old localStorage formats

**Data flow:**
```
CVProvider (context)
  → useCV() hook
    → Components consume/update via context methods
      → Auto-save to localStorage
```

### Data Model: src/lib/types.ts

Central data structure: `CVData` interface containing:
- `personalInfo` - Name, title, photo (base64), email, phone, location, linkedin, website
- `summary` - About me text
- `experience[]` - Work history with bullet points
- `education[]` - Academic background
- `skills[]` - Categorized skills

**All items use string `id` generated by `generateId()` (random base36)**

### Component Architecture

```
src/app/page.tsx (root)
├── CVProvider (context wrapper)
└── AppContent
    ├── Toolbar (import/export/PDF controls)
    ├── CVEditor
    │   └── CVPreview (main editor with two-column layout)
    │       ├── LEFT COLUMN
    │       │   └── PersonalInfo (photo, contact fields, summary, skills)
    │       └── RIGHT COLUMN
    │           ├── CVHeader (name & title, editable)
    │           ├── Experience (work history)
    │           └── Education
    └── PrintableCV (hidden, for PDF generation)
```

### Inline Editing Pattern

**EditableText** component (`src/components/cv-editor/EditableText.tsx`) is the foundation:
- Click to edit, Escape to cancel, Enter/blur to save
- Draft state prevents accidental saves
- Handles both single-line and multiline (textarea)
- Used throughout: names, dates, descriptions, everything editable

**Usage pattern:**
```typescript
<EditableText
  value={item.field}
  onChange={(newValue) => updateItem(item.id, { field: newValue })}
  placeholder="Click para editar..."
  multiline={false}
  as="body" // or "heading", "subheading", "small"
/>
```

### PDF Generation: react-to-print

**Two separate render trees:**
1. **CVPreview** - Interactive editor with buttons, hover states, edit controls
2. **PrintableCV** - Static, print-optimized layout (no buttons, optimized spacing)

`PrintableCV` uses `forwardRef` and is rendered hidden. `react-to-print` creates PDF from it.

**Critical:** PrintableCV must stay in sync with CVPreview structure. When adding sections to editor, add to both components.

### Persistence: localStorage

**Key:** `"cv-builder-data"`
**Format:** JSON serialized CVData
**Save trigger:** Any change to `data` state in CVContext
**Timing:** 500ms debounce via useEffect cleanup

**Migration strategy:**
- `migrateCVData()` runs on load to handle old localStorage formats (e.g., contacts array → individual fields)
- Allows smooth updates without breaking existing users' data

### Styling: Tailwind CSS v4 + shadcn/ui

**Tailwind v4 specifics:**
- Uses `@theme inline` syntax (not `theme()` function)
- CSS variables defined in `src/app/globals.css`
- PostCSS with `@tailwindcss/postcss`

**shadcn/ui components:**
- Located in `src/components/ui/`
- New York style, neutral base color
- Add new components: `npx shadcn@latest add [name]`
- Icons: lucide-react only (400+ icons available)

**Color scheme:**
- Primary: Gray-900 (#111827)
- Backgrounds: White with gray-50 accents
- Interactive: Red-600 for destructive actions
- Consistent hover states: opacity-0 → opacity-100 transitions

### ID Generation and Array Operations

**IDs:** All items use `id: string` generated by:
```typescript
function generateId(): string {
  return Math.random().toString(36).substring(2, 9);
}
```

**Move operations:** Use `moveItem<T>()` helper in cv-context.tsx:
- Swaps adjacent items by index
- Prevents out-of-bounds moves
- Used by Experience and Education "up/down" arrows

**Remove operations:** All use `.filter(item => item.id !== id)` pattern

**Update operations:** All use `.map(item => item.id === id ? {...item, ...updates} : item)` pattern

## Key Patterns to Follow

### When Adding New Sections

1. **Define types** in `src/lib/types.ts`
2. **Add to CVData** interface
3. **Add default data** in `src/lib/default-data.ts`
4. **Add CRUD methods** to cv-context.tsx:
   - Add interface methods to CVContextValue
   - Implement with useCallback
   - Add to provider value
5. **Create component** in `src/components/cv-editor/`
   - Use EditableText for all editable fields
   - Follow hover-reveal pattern for delete buttons
   - Use memo() for performance
6. **Add to CVPreview** (editor view)
7. **Add to PrintableCV** (PDF view)

### Spanish Language (Argentine)

All UI text uses Argentine Spanish with **voseo**:
- "Agregá" not "Agrega"
- "Mostrá" not "Muestre"
- "Hacé" not "Haz"
- Informal "vos" conjugation throughout

### Component Conventions

- All client components: `"use client"` directive at top
- Export pattern: `export const ComponentName = memo(function ComponentName(props) { ... })`
- Props: Define TypeScript interface above component
- Hooks: Extract context methods at component top: `const { data, updateFoo, addFoo } = useCV()`
- Styling: Tailwind classes only, no CSS modules or styled-components

### Performance

- **memo()** all components to prevent unnecessary renders
- **useCallback()** all context methods (empty dependency array safe due to functional setState)
- **Debounced auto-save** already implemented, don't add more debouncing
- Avoid nested context providers

## File Organization

```
src/
├── app/
│   ├── globals.css          # Tailwind base, CSS variables
│   ├── layout.tsx           # Root layout with fonts
│   └── page.tsx             # Entry point, CVProvider wrapper
├── lib/
│   ├── types.ts             # All TypeScript interfaces
│   ├── cv-context.tsx       # State management (CVContext)
│   ├── default-data.ts      # Initial CV data
│   ├── storage.ts           # localStorage load/save
│   └── utils.ts             # shadcn cn() utility
└── components/
    ├── ui/                  # shadcn/ui components
    ├── toolbar/             # Toolbar (import/export/PDF)
    └── cv-editor/           # CV editing components
        ├── CVEditor.tsx         # Wrapper
        ├── CVPreview.tsx        # Main editor (two columns)
        ├── PrintableCV.tsx      # PDF render tree
        ├── EditableText.tsx     # Inline edit base component
        ├── Experience.tsx       # Work history section
        ├── Education.tsx        # Education section
        └── PersonalInfo.tsx     # Left column (photo, contact fields, summary, skills)
```

## Debugging Tips

**State issues:**
- Check CVContext methods are called (not direct state mutation)
- Verify useCallback dependencies (should be empty `[]`)
- Check localStorage in DevTools → Application → Local Storage

**Styling issues:**
- Verify Tailwind classes are valid for v4 (check docs)
- Check `@theme inline` syntax in globals.css
- Verify lucide-react icon imports

**PDF issues:**
- Check PrintableCV matches CVPreview structure
- Verify `ref={printRef}` on PrintableCV div
- Check A4 page sizing in pageStyle

**Migration issues:**
- Check `migrateCVData()` in cv-context.tsx
- Verify backward compatibility when changing types.ts

## Critical Files for Features

When implementing new features, these files almost always need updates:

1. **src/lib/types.ts** - Add/modify data structures
2. **src/lib/cv-context.tsx** - Add CRUD methods
3. **src/lib/default-data.ts** - Add default values
4. **src/components/cv-editor/CVPreview.tsx** - Add to editor UI
5. **src/components/cv-editor/PrintableCV.tsx** - Add to PDF output

## Notion Documentation

There is onboarding documentation in Notion (root page ID: `30ae66e2-f906-81c1-9a44-f4f364803bbe`). When making **significant changes** to the project, remind the user to update the corresponding Notion page. Significant changes include:
- Adding/removing CV sections
- Adding new libraries or replacing existing ones
- Changes to architecture (new providers, new contexts, auth, database)
- Changes to the sharing/PDF flow
- Changes to i18n (new languages, changed setup)

Do NOT auto-update the docs on every commit. Only flag it when the change would make the docs inaccurate.
